# FlasherXUpdater

## Introduction
This is an Arduino library that will support the updating of Teensy firmware from data that is
transferred via USB, UART, or TCP. It uses the [FlasherX code](https://github.com/joepasquariello/FlasherX)
to perform the actual firmware update, and provides code to detect when update data is available. It
also provides data integrity checks with size and a CRC32 value to verify the data has been transferred
successfully. It packages all of this code into an Arduino library so that it can be easily reused
across Arduino sketches.

## Dependencies
Because this is a library that I use on a regular basis on my own projects, the code is also dependent
on other libraries that I have written or use. Please see the
[DEPENDENCIES](https://github.com/markwomack/FlasherXUpdater/blob/main/DEPENDENCIES.md) page that lists
the specific dependencies, with links to locations you can download them. However, if these dependencies
are more than you want or need, you can see the
[TeensyOTAViaTCP project](https://github.com/markwomack/TeensyOTAViaTCP) where the core FlasherX updating
code does not have the dependencies. The surrounding example code has the dependencies, but you can use it
to write your own code without them.

## Usage

### Monitoring that update data is available
Before any update can be performed, the update data must be read and processed. And before that can
happen the data availability must be detected. This is done using one of the provided CheckForXXXUpdateTask
classes. The availability of the update data is periodically checked using bt registering the update task
with the Task Manager. There are [examples](https://github.com/markwomack/FlasherXUpdater/tree/main/examples)
that demonstrate this usage.

### Performing the update
Once the update data is detected, an the data should be processed, and if the data is valid and successfully
transferred, and the firmware should be updated. This is managed by the
[FlasherXUpdater](https://github.com/markwomack/FlasherXUpdater/blob/main/src/FlasherXUpdater.h) class.Use
of the performUpdate method is demonstrated in the
[examples](https://github.com/markwomack/FlasherXUpdater/tree/main/examples).

## Expected format of the update data
The update data is expected to be in the form of an Arduino .hex file. This file is generated by the Arduino
IDE environment when you choose the Verify or Upload options. Since this library is providing a mechanism
to update the Teensy through a different process, you will probably use just the Verify command. Then you
need to know where the generated .hex file is located. You can use the Teensy Loader (which is always opened
when you compile a sketch) to locate the file. Use the **File->Open Hex File** option. This will open a file
dialog in the directory that the .hex file is located.

Once you have the location of the .hex file, you can use one of the provided
[scripts](https://github.com/markwomack/FlasherXUpdater/tree/main/scripts) to send the data to the desired
destination. The scripts will add the file size and CRC32 value of the .hex file to the beginning of the
.hex file. The resulting file is then sent for the update. The performUpdate and modified FlasherX code
will double check these values after the .hex file contents have been processed. If the values do not
match, then the update will be aborted.
